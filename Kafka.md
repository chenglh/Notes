Kafka

~~~php
##课程链接 kafka
https://www.bilibili.com/video/BV1wv411z75h?from=search&seid=1900096829405076912

##课程连接 RabbitMQ
https://www.bilibili.com/video/BV1gW411H7Az?from=search&seid=11681702358228348604
~~~

##### 第1节 Kafka简介

###### 1.1 消息队列

举例：1W个人抢1000张票，1W个秒杀100件商品......

![image-20200708144020338](H:\笔记本\Kafka.assets\image-20200708144020338.png)



###### 1.2 消息队列

- 消息Message

  网络中的两台计算机或者两个通讯设备之间传递的数据。例如说：文本、音乐、视频等内容。

- 队列Queue

  一种特殊的线性表(数据元素首尾相接)，特殊之处在于只允许在首部删除元素和在尾部追加元素(FIFO)。

- 消息队列MQ

  消息+队列，保存消息的队列。消息的传输过程中的容器；主要提供生产、消费接口外部调用数据的存储和获取

###### 1.3 消息队列分类

> MQ主要分两类：点对点(p2p)、发布订阅(Pub/Sub)

1、Peer-to-Peer

**一般基于Pull或者Polling接收数据**
发送到队列中的消息被一个而且仅仅一个接收者接受；即使有多个接收者在同一个队列中侦听，也只有一个能消费。(打电话)

<img src="H:\笔记本\Kafka.assets\image-20200708151954001.png" alt="image-20200708151954001" style="zoom:80%;" />

2、发布订阅

**发布到同一个主题的消息，可被多个订阅者接收**

![image-20200708151641769](H:\笔记本\Kafka.assets\image-20200708151641769.png)



###### 1.4 p2p和发布订阅MQ比较

> 共同点：

​    消息生产者生产消息发送到queue中，然后消息消费者从queue中读取并且消费消息。

> 不同点：

​    1、p2p模型包括：消息队列(queue)、发送者(sender)、接收者(receiver)

​    一个生产者生产的消息只有一个消费者(consumer)，即一旦被消费，消息就不在消息队列中，比如打电话。

​    2、pub/sub包含：消息队列(queue)、主题(topic)、发布者(publisher)、订阅者(subscriber)

​    每个消息可以有多个消费者，彼此互不影响。比如：发布微博，粉丝都能看到。

###### 1.5 消息系统的使用场景

~~~
•解耦 各系统之间通过消怠系统这个统一的接口交换数据，无须了解彼此的存在
•冗余 部分消息系统具有消息持久化能力，可规避消息处理前丟失的风险
•扩展 消息系统是统一的数据接口，各系统可独立扩展
•峰值处理能力 消息系统可顶住峰值流量，业务系统可根据处理能力从消息系统中获取并处理对应量的请求
•可恢复性 系统中部分键失效并不会影明整个系统，它恢复会仍然可从消息系统中获取并处理数据
•异步通信 在不需要立即处理请求的场景下，可以将请求放入消息系统，合适的时候再处理
~~~

常见消息系统

~~~
1、RabbitMQ Erlang编写,支持多协议AMQP, XMPP, SMTP, STOMP。支持负载均衡、数据持久化。同时支持Peer-to-Peer和发布/订阅模式

2、Redis基于Key-Value对的NoSQL数据库,同时支持MQ功能，可做轻量级队列服务使用。就入队操作而言，Redis对短消息(小于10kb)的性能比RabbitMQ好，长消息性能比RabbitMQ差

3、ZeroMQ轻量级，不需要单独的消息服务器或中间件，应用程序本身扮演该角色，Peer-to-Peer。 它实质上是一个库，需要开发人员自己组合多种技术,使用复杂度高

4、ActiveMQ JMS实现，Peer-to-Peer, 支持持久化、XA(分布式)事务

5、Kafka/Jafka高性能跨语言的分布式发布/订阅消息系统，数据持久化，全分布式，同时支持在线和离线处理

6、MetaQ/RocketMQ纯ava实现，发布/订阅消息系统，支持本地事务和XA分布式事务
~~~

##### 第2节 Kafka

###### 2.1 简介

Kafka是分布式的发布一-订阅消息系统。它最初由LinkedIn(领英)公司发布， 使用Scala语言编写，与2010年12月份开源，成为Apache的顶级项目。Kafka是一 个高吞吐量的、 持久性的、分布式发布订阅消息系统。它主要用于处理活跃live的数据(登录、浏览、点击分享、喜欢等用户行为产生的数据)。

![image-20200710110058680](H:\笔记本\Kafka.assets\image-20200710110058680.png)

~~~php
#kafka官网
http://kafka.apachecn.org
~~~

> 三大特点

- 高吞吐量  可以满足每秒百万级别消息的生产和消费----生产消费
- 持久性      有一套完善的消息存储机制，确保数据的高效安全的持久化----中间件
- 分布式      基于分布式的扩展和容错机制；Kafka的数据都会复制到几台服务器上，当某一台故障失效时，生产者和消费者转而使用其他的机器----故障转移



###### 2.1 设计目标

- **高吞吐率** 在廉价的商用机器上单机可支持每秒100万条消息的读写
- **消息持久化** 所有消息均被持久化到磁盘，无消息丢失，支持消息重放
- **完全分布式** Producer, Broker, Consumer均支持水平扩展(动态扩容/横向扩展)
- 同时适应在线流处理和离线批处理



https://www.bilibili.com/video/BV1wv411z75h?p=5



